<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Super Scout</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: linear-gradient(135deg, #f0f4f8, #d9e2ec); color: #333; }
  h1 { text-align: center; color: #003366; margin-bottom: 20px; }
  #scout_name{margin-bottom:40px;}
  .robot-section { margin-bottom: 40px; padding: 10px; border-radius: 10px; flex:1;}
  #red-section { background: rgba(255,0,0,0.05); border: 2px solid rgba(255,0,0,0.3); }
  #blue-section { background: rgba(0,0,255,0.05); border: 2px solid rgba(0,0,255,0.3); }
  #rating-section{display:flex; gap:10px}
  .section-title { text-align: center; font-size: 1.5em; font-weight: bold; margin-bottom: 10px; }
  .alliance-inputs label {display: inline-block;  margin-top: 10px; margin-right:4px;}
  .alliance-inputs {  display: flex;  flex-wrap: wrap;  justify-content: center; }
  .alliance-inputs input {width: 50px; padding: 2px; margin-top: 5px; margin-right: 20px; text-align:center; font-size: 1em;}
  input[type=number]::-webkit-inner-spin-button {transform: scale(1.8); }

  .robot-row { display: flex; justify-content: space-between; gap: 10px; margin-top: 20px;}
  .robot-card { background: #fff; flex: 1; padding: 15px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
  h2 { text-align: center; margin-bottom: 10px; color: #222; }
  label { font-weight: bold; display: block; margin-top: 10px; }
  input, select, textarea { width: 100%; padding: 6px; margin-top: 3px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.95em; }
  textarea { resize: vertical; min-height: 50px; }
  .actions { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
  button { background: #007bff; color: white; border: none; padding: 12px 18px; border-radius: 5px; cursor: pointer; margin-top: 15px; font-size: 1em; }
  button:hover { background: #0056b3; }
  #status-list { margin-top: 30px; padding: 15px; background: #fff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); } 
</style>
</head>
<body>
  <h1>Super Scout</h1>
  <label for="scout_name">Scout Name:</label>
  <input type="text" id="scout_name" placeholder="Enter your name" />
  <div id = "rating-section">
    <div class="robot-section" id="red-section">
      <div class="section-title">Red Alliance</div>
      <div class="alliance-inputs">
        <label>Alliance Net Success:</label><input type="number" id="red_success" min="0" value="0">
        <label>Alliance Net Fail:</label><input type="number" id="red_fail" min="0" value="0">
      </div>
      <div class="robot-row" id="red-row"></div>
    </div>

    <div class="robot-section" id="blue-section">
      <div class="section-title">Blue Alliance</div>
      <div class="alliance-inputs">
        <label>Alliance Net Success:</label><input type="number" id="blue_success" min="0" value="0">
        <label>Alliance Net Fail:</label><input type="number" id="blue_fail" min="0" value="0">
      </div>
      <div class="robot-row" id="blue-row"></div>
    </div>
  </div>

  <div class="actions">
    <button id="submit-btn" type="button">Submit to Google Sheet</button>
    <button id="generate-btn" type="button">Generate QR Code</button>
  </div>

  <div id="status-list"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
  const API_URL = 'YOUR_DEPLOYED_WEBAPP_URL';  // <-- replace with your Apps Script URL

  function ratingOptions() {
    return Array.from({length: 5}, (_, i) => `<option value="${i+1}">${i+1}</option>`).join('');
  }

  function createRobotCard(robotId) {
    const c = document.createElement('div');
    c.className = 'robot-card';
    c.innerHTML = `
      <h2>${robotId}</h2>
      <label>Team Number:</label><input type="number" id="${robotId}_team" min="0" placeholder="Team #">
      <label>Driver Skill (1-5):</label><select id="${robotId}_driver">${ratingOptions()}</select>
      <label>Speed (1-5):</label><select id="${robotId}_speed">${ratingOptions()}</select>
      <label>Defense (1-5):</label><select id="${robotId}_defense">${ratingOptions()}</select>
      <label>Comments:</label><textarea id="${robotId}_comments" placeholder="Enter comments..."></textarea>`;
    return c;
  }

  function collectAllRobotsTSV() {
    const scoutName = document.getElementById('scout_name').value || '';
    const alliances = [
      { name: 'Red', prefix: 'R', success: document.getElementById('red_success').value, fail: document.getElementById('red_fail').value },
      { name: 'Blue', prefix: 'B', success: document.getElementById('blue_success').value, fail: document.getElementById('blue_fail').value }
    ];

    let lines = [];
    alliances.forEach(a => {
      for (let i=1; i<=3; i++) {
        let row = [
          new Date().toISOString(), // timestamp
          scoutName,
          a.name,
          a.success,
          a.fail,
          `${a.prefix}${i}`,
          document.getElementById(`${a.prefix}${i}_team`).value,
          document.getElementById(`${a.prefix}${i}_driver`).value,
          document.getElementById(`${a.prefix}${i}_speed`).value,
          document.getElementById(`${a.prefix}${i}_defense`).value,
          document.getElementById(`${a.prefix}${i}_comments`).value.replace(/\t/g, " ")
        ];
        lines.push(row.join("\t"));
      }
    });
    return lines.join("\n");
  }

  async function submitToGoogleSheet() {
    const tsvData = collectAllRobotsTSV();
    try {
      await fetch(API_URL, {
        method: "POST",
        mode: "no-cors",   // required for Apps Script
        headers: { "Content-Type": "text/plain" },
        body: tsvData
      });
      document.getElementById('status-list').innerHTML = `<p style="color:green;">Submitted successfully!</p>`;
    } catch (err) {
      document.getElementById('status-list').innerHTML = `<p style="color:red;">Error: ${err}</p>`;
    }
  }

  function openQRCodePage() {
    const tsvData = collectAllRobotsTSV();
    document.getElementById('status-list').innerHTML = '<div id="qrcode"></div>';
    new QRCode(document.getElementById("qrcode"), {
      text: tsvData,
      width: 256,
      height: 256
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    ['R1','R2','R3'].forEach(r => document.getElementById('red-row').appendChild(createRobotCard(r)));
    ['B1','B2','B3'].forEach(r => document.getElementById('blue-row').appendChild(createRobotCard(r)));
    document.getElementById('submit-btn').addEventListener('click', submitToGoogleSheet);
    document.getElementById('generate-btn').addEventListener('click', openQRCodePage);
  });
</script>
</body>
</html>
